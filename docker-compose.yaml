services:
  web:
    build: 
      context: .
    depends_on:
      - postgres
    environment:
      # For local development you can set DATABASE_URL to point to a local or remote DB.
      # Example: "Host=host.docker.internal;Port=5432;Database=mydb;Username=myuser;Password=mypassword"
      # Use the compose service name 'postgres' so DNS resolves inside the compose network
      DATABASE_URL: "Host=postgres;Port=5432;Database=mydb;Username=myuser;Password=mypassword"
      GOOGLE_API: AIzaSyD6ZjtfC8q-RLrvqxDnDLmCLj8Imbvyyj8
      CUSTOM_SEARCH_ENGINE: f642808a9e0124077
      PIXABAY_API_KEY: ${PIXABAY_API_KEY}
    ports:
      - "8000:8080"
  
  client: 
    build: 
      context: ./AgentFront/Agent.Api
      dockerfile: Dockerfile
      args:
        # Provide the API URL used by the built frontend (Vite build time)
        VITE_API_URL: "http://localhost:8000"
        VITE_OIDC_AUTHORITY: "https://auth-dev.snowse.io/realms/DevRealm"
        VITE_OIDC_CLIENT_ID: "nagent" ## local dev client id
        VITE_OIDC_REDIRECT_URI: "http://localhost:5173/callback"
        VITE_OIDC_POST_LOGOUT_REDIRECT_URI: "http://localhost:5173/"
        VITE_OIDC_RESPONSE_TYPE: "code"
        VITE_OIDC_SCOPE: "openid profile email"
    ports:
      - "5173:80"

  facebook-mcp-service:
    build:
      context: ./Agent.mcp
      dockerfile: Dockerfile
    container_name: facebook-mcp-service
    ports:
      - "8001:8000"
    environment:
      - PYTHONUNBUFFERED=1
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    volumes:
      - ./Agent.mcp/.env:/app/.env:ro

  postgres:
    image: postgres:15
    restart: unless-stopped
    environment:
      POSTGRES_DB: mydb
      POSTGRES_USER: myuser
      POSTGRES_PASSWORD: mypassword
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  postgres_data: